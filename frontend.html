<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./frontend.css" />
    <title>Simple Web Page</title>
  </head>
  <body>
    <div class="main">
      <div class="content">
        <div class="logo-heading">Escrow Contract</div>
        <div class="center">
          <div class="w-halfLeft">
            <div class="front-left">
              <div class="address">
                <div class="time-line">
                  <div class="title">Total Funds In Escrow:</div>
                  <div class="time-infor">
                    <div class="time">
                      <span id="form-total-amount" class="fm-control"
                        >Amount</span
                      >
                      <span id="token-symbol" class="unit">USDT</span>
                    </div>
                  </div>
                </div>
                <div class="time-line">
                  <div class="title">Released Amount:</div>
                  <div class="time-infor">
                    <div class="time">
                      <span id="form-released-amount" class="fm-control"
                        >Amount</span
                      >
                      <span id="token-name" class="unit">USDT</span>
                    </div>
                  </div>
                </div>
              </div>
              <div id="remaining-time" class="remaining-time">
                <div class="time-big">
                  <div id="time-hour-dis" class="time-hour">
                    <div id="remaining-time-days">00</div>
                    <div class="remaining-time-div">:</div>
                    <div id="remaining-time-hour">00</div>
                    <div class="remaining-time-div">:</div>
                    <div id="remaining-time-min">00</div>
                    <div class="remaining-time-div">:</div>
                    <div id="remaining-time-sec">00</div>
                  </div>
                  <div id="iv96ql" class="time-unit">
                    <span>Days</span>
                    <span>Hrs</span>
                    <span>Min</span>
                    <span>Sec</span>
                  </div>
                </div>
                <div class="alert">
                  <div id="ivygf">Remaining time until expiry</div>
                </div>
              </div>
              <div id="contract-result" class="contract-history">
                <div id="result-title">Contract Expired</div>
              </div>
            </div>
          </div>
          <div class="w-halfRight">
            <div class="date">
              <div class="left">
                <div class="time-duration">
                  <div class="title">StartDate:</div>
                  <div class="time-number">
                    <div class="time">
                      <span id="form-start-_date" class="fm-control">Date</span>
                    </div>
                  </div>
                </div>
                <div class="time-duration">
                  <div class="title">EndDate:</div>
                  <div class="time-number">
                    <div class="time">
                      <span id="form-end-_date" class="fm-control">Date</span>
                    </div>
                  </div>
                </div>
                <div class="time-duration">
                  <div class="title">Duration:</div>
                  <div class="time-number">
                    <div class="time">
                      <span id="form-duration-_date" class="fm-control"
                        >Date</span
                      >
                      <span id="form-unit" class="timeunit">Days</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="cms">
                <div class="cms hidden">
                  <button
                    id="start-date"
                    type="button"
                    data-form-name="startTime"
                    class="btn btn-primary mt-2"
                  >
                    StartDate
                  </button>
                  <span
                    id="form-output-startTime-0"
                    data-form-name="startTime"
                    data-field-type="uint256"
                    class="form-control"
                    >uint256</span
                  >
                  <button
                    id="contract-duration"
                    type="button"
                    data-form-name="duration"
                    class="btn btn-primary mt-2"
                  >
                    Duration
                  </button>
                  <span
                    id="form-output-duration-0"
                    data-form-name="duration"
                    data-field-type="uint256"
                    class="form-control"
                    >uint256</span
                  >
                  <button
                    id="end-date"
                    type="button"
                    data-form-name="endTime"
                    class="btn btn-primary mt-2"
                  >
                    EndTime
                  </button>
                  <span
                    id="form-output-endTime-0"
                    data-form-name="endTime"
                    data-field-type="uint256"
                    >uint256</span
                  >
                  <button
                    id="total-amount"
                    type="button"
                    data-form-name="amount"
                    class="btn btn-primary mt-2"
                  >
                    TotalfundsinEscrow
                  </button>
                  <span
                    id="form-output-amount-0"
                    data-form-name="amount"
                    data-field-type="uint256"
                    >uint256</span
                  >
                  <button
                    id="released-amount"
                    type="button"
                    data-form-name="totalReleasedAmount"
                    class="btn btn-primary mt-2"
                  >
                    TotalReleasedAmount
                  </button>
                  <span
                    id="form-output-totalReleasedAmount-0"
                    data-form-name="totalReleasedAmount"
                    data-field-type="uint256"
                    >uint256</span
                  >
                  <button
                    id="getchainId"
                    type="button"
                    data-form-name="getChainID"
                    class="btn btn-primary mt-2"
                  >
                    Read
                  </button>
                  <span
                    id="form-output-getChainID-0"
                    data-form-name="getChainID"
                    data-field-type="uint256"
                    >uint256</span
                  >
                </div>
              </div>
            </div>
            <div class="address">
              <table id="transactionTable" class="desktop-only">
                <thead>
                  <tr class="table-title">
                    <th>Type of Transaction</th>
                    <th>Amount</th>
                    <th>Transaction Date</th>
                    <th id="iyv7bo">Contract Expiry Date</th>
                  </tr>
                </thead>
                <tbody id="transactionTbody" class="table-body"></tbody>
              </table>
              <div id="ivzl83" class="flex flex-row mobile-only">
                <div id="i0nnjf" class="flex flex-col mobile-only">
                  <div>Type of Transaction</div>
                  <div>Amount</div>
                  <div>Transaction Date</div>
                  <div>Contract Expiry Date</div>
                </div>
                <div id="igtvl2" class="swiper-container mobile-only">
                  <div class="swiper-wrapper"></div>
                  <div class="swiper-pagination"></div>
                </div>
              </div>
            </div>
            <div class="address">
              <div class="time-line">
                <div class="title">Escrow Contract Address:</div>
                <div class="time-infor">
                  <div>
                    <span id="form-escrow-_address" class="fm-control"
                      >Address</span
                    >
                  </div>
                </div>
              </div>
              <div class="time-line">
                <div class="title">Depositor Wallet Address:</div>
                <div class="time-infor">
                  <div>
                    <span id="form-depositor-_address" class="fm-control"
                      >Address</span
                    >
                  </div>
                </div>
              </div>
              <div class="time-line">
                <div class="title">Recipient Wallet Address:</div>
                <div class="time-infor">
                  <div>
                    <span id="form-recipient-_address" class="fm-control"
                      >Address</span
                    >
                  </div>
                </div>
              </div>
              <div class="cms hidden">
                <button
                  id="escrow-address"
                  type="button"
                  data-form-name="getContractAddress"
                  class="btn btn-primary mt-2"
                >
                  EscrowContractAddress
                </button>
                <span
                  id="form-output-getContractAddress-0"
                  data-form-name="getContractAddress"
                  data-field-type="address"
                  class="form-control"
                  >address</span
                >
                <button
                  id="client-address"
                  type="button"
                  data-form-name="client"
                  class="btn btn-primary mt-2"
                >
                  Client
                </button>
                <span
                  id="form-output-client-0"
                  data-form-name="client"
                  data-field-type="address"
                  class="form-control"
                  >address</span
                >
                <button
                  id="dev-address"
                  type="button"
                  data-form-name="dev"
                  class="btn btn-primary mt-2"
                >
                  Developer
                </button>
                <span
                  id="form-output-dev-0"
                  data-form-name="dev"
                  data-field-type="address"
                  class="form-control hidden"
                  >address</span
                >
                <button
                  id="usdt-address"
                  type="button"
                  data-form-name="USDT"
                  class="btn btn-primary mt-2 hidden"
                >
                  tokenAddress
                </button>
                <span
                  id="form-output-USDT-0"
                  data-form-name="USDT"
                  data-field-type="address"
                  class="form-control hidden"
                  >address</span
                >
              </div>
            </div>
            <div class="note">
              <div>
                <strong id="ixsw2o">Note:</strong>
                After expiration of escrow funds will go back to the Depositing
                Party
              </div>
            </div>
          </div>
        </div>
        <div class="footer">
          <div class="bottom">
            <div class="icon">
              <div id="ijqgwc">Built with Forward Factory</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.1.esm.min.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script defer>
      function populateSwiper() {
        const tableBody = document.getElementById("transactionTbody");
        const swiperWrapper = document.querySelector(".swiper-wrapper");
        swiperWrapper.innerHTML = "";
        // Clear existing slides
        Array.from(tableBody.children).forEach((row, index) => {
          const swiperSlide = document.createElement("div");
          swiperSlide.className = "swiper-slide";
          swiperSlide.innerHTML = ` 
  <div class="slide-content">
  <div>${row.cells[0].innerText}
	  </div>
  <div>${row.cells[1].innerText}
	  </div>
  <div>${row.cells[2].innerText}
	  </div>
  <div>${row.cells[3].innerText}
	  </div>
	  </div>
  `;
          swiperWrapper.appendChild(swiperSlide);
        });
        // Initialize Swiper
        new Swiper(".swiper-container", {
          slidesPerView: 1,
          spaceBetween: 10,
          slidesPerGroup: 1,
          pagination: {
            el: ".swiper-pagination",
            clickable: true,
          },
        });
      }
      setTimeout(() => {
        document.getElementById("usdt-address").click();
        document.getElementById("getchainId").click();
        document.getElementById("escrow-address").click();
        document.getElementById("client-address").click();
        document.getElementById("dev-address").click();
      }, 500);
      console.log("Toeken button is clicked-------->");
      document
        .getElementById("dev-address")
        .addEventListener("click", function () {
          setTimeout(() => {
            getDecimals();
            convertAddress();
          }, 4000);
        });
      function convertAddress() {
        const escrowAddress = document.getElementById(
          "form-output-getContractAddress-0"
        ).innerHTML;
        console.log("Escrow Address : " + escrowAddress);
        document.getElementById("form-escrow-_address").innerHTML =
          escrowAddress;
        console.log("Escrow Address : " + escrowAddress);
        const clientAddress = document.getElementById(
          "form-output-client-0"
        ).innerHTML;
        document.getElementById("form-depositor-_address").innerHTML =
          clientAddress;
        const devAddress =
          document.getElementById("form-output-dev-0").innerHTML;
        document.getElementById("form-recipient-_address").innerHTML =
          devAddress;
      }
      let decimal = 0;
      var eventLog = [];
      async function getDecimals() {
        // Fetch the list of chains
        const chainListResponse = await fetch(
          "https://chainid.network/chains.json"
        );
        const chainList = await chainListResponse.json();
        console.log("chianList ; " + chainList);
        // Get the current network details using a fallback method if this.parent.ethereum is not available
        const chainId = document.getElementById(
          "form-output-getChainID-0"
        ).innerHTML;
        // Fallback to mainnet if this.parent.ethereum is not available
        console.log("chainId : " + chainId);
        // Find the matching chain data
        const chainData = chainList.find(
          (obj) => obj.chainId.toString() === chainId.toString()
        );
        console.log("Chain Data : " + JSON.stringify(chainData));
        // Extract the RPC URL from the matched chain data
        const INFURA_API_KEY = "810dfc7ee2d74f1ea3ad5de43ada13e1";
        // Replace with your actual Infura API key
        const rpcUrl = chainData.rpc[0];
        console.log("Net URl: " + JSON.stringify(rpcUrl));
        // Create a JsonRpcProvider using the selected RPC URL
        const provider = new ethers.providers.JsonRpcProvider(rpcUrl);
        // Replace with the contract address and ABI
        const tokenAddress =
          document.getElementById("form-output-USDT-0").innerHTML;
        // Replace with your contract's address
        const abi = [
          {
            constant: true,
            inputs: [],
            name: "decimals",
            outputs: [
              {
                name: "",
                type: "uint8",
              },
            ],
            payable: false,
            stateMutability: "view",
            type: "function",
          },
          {
            constant: true,
            inputs: [],
            name: "symbol",
            outputs: [
              {
                name: "",
                type: "string",
              },
            ],
            payable: false,
            stateMutability: "view",
            type: "function",
          },
        ];
        // Instantiate the contract with the new provider
        const coinContract = new ethers.Contract(tokenAddress, abi, provider);
        // Fetch the decimals
        try {
          const decimals = await coinContract.decimals();
          const symbol = await coinContract.symbol();
          console.log(`Decimals: ${decimals.toString()}
  `);
          console.log("Symbol : " + symbol);
          document.getElementById("token-symbol").innerText = symbol;
          document.getElementById("token-name").innerText = symbol;
          decimal = decimals;
          setTimeout(() => {
            document.getElementById("total-amount").click();
            document.getElementById("released-amount").click();
            document.getElementById("start-date").click();
            document.getElementById("contract-duration").click();
            document.getElementById("end-date").click();
            document.getElementById("transaction-history").click();
            console.log("button click-------->");
          }, 500);
        } catch (error) {
          console.error("Error fetching decimals:", error);
        }
      }
      console.log("decimal : " + decimal);
      document
        .getElementById("transaction-history")
        .addEventListener("click", function () {
          setTimeout(() => {
            releaseFund();
            console.log("function is called------->");
            totalFund();
            convertTime();
            convertDuration();
          }, 3500);
        });
      function totalFund() {
        const totalAmount = document.getElementById(
          "form-output-amount-0"
        ).innerHTML;
        console.log("totalamount :" + totalAmount, ":", decimal);
        const correctTotal = Number(totalAmount) / 10 ** decimal;
        console.log("Total Funds : " + totalAmount);
        document.getElementById("form-total-amount").innerHTML = correctTotal;
      }
      function releaseFund() {
        const releasedAmount = document.getElementById(
          "form-output-totalReleasedAmount-0"
        ).innerHTML;
        const correctRelease = Number(releasedAmount) / 10 ** decimal;
        console.log("Released Amount : ", +correctRelease);
        document.getElementById("form-released-amount").innerHTML =
          correctRelease;
      }
      function convertTime() {
        function formatDate(timestamp) {
          const date = new Date(timestamp);
          const hours = date.getUTCHours().toString().padStart(2, "0");
          const minutes = date.getUTCMinutes().toString().padStart(2, "0");
          const day = date.getUTCDate();
          const month = date.toLocaleString("en-US", {
            month: "short",
            timeZone: "UTC",
          });
          const year = date.getUTCFullYear();
          return `${hours}
  :${minutes}
  GMT, ${day}
  ${month}
  ${year}
  `;
        }
        const startTimeElement = document.getElementById(
          "form-output-startTime-0"
        ).innerHTML;
        const startTimeStr = startTimeElement.trim();
        const startTime = parseInt(startTimeStr, 10) * 1000;
        // Convert to milliseconds if valid, otherwise set to 0
        console.log(startTime);
        const startTimeUTC = new Date(startTime).toUTCString();
        console.log(startTimeUTC);
        const endTimeElement = document.getElementById(
          "form-output-endTime-0"
        ).innerHTML;
        const endTimeStr = endTimeElement.trim();
        const endTime = parseInt(endTimeStr, 10) * 1000;
        const endTimeUTC = new Date(endTime).toUTCString();
        const now = Math.floor(Date.now());
        console.log(endTimeUTC);
        // Always display the start and end dates
        if (startTime <= 0 || isNaN(startTime)) {
          document.getElementById("form-start-_date").innerHTML =
            "Escrow not initialized yet.";
        } else {
          document.getElementById("form-start-_date").innerHTML =
            formatDate(startTime);
          document.getElementById("form-unit").style.display = "flex";
        }
        if (endTime <= 0 || isNaN(endTime)) {
          document.getElementById("form-end-_date").innerHTML =
            "Escrow not initialized yet.";
        } else if (now > endTime) {
          document.getElementById("form-end-_date").innerHTML =
            "Contract has expired.";
        } else {
          document.getElementById("form-end-_date").innerHTML =
            formatDate(endTime);
          document.getElementById("form-unit").style.display = "flex";
          console.log(formatDate(endTime));
        }
        if (endTime > 0) {
          // Set up the interval to update the countdown
          var countDownInterval = setInterval(function () {
            var currentUTCTimeInMilliseconds = new Date().getTime();
            var remainingTimeInMilliseconds =
              endTime - currentUTCTimeInMilliseconds;
            remainingDays = Math.floor(
              remainingTimeInMilliseconds / (1000 * 60 * 60 * 24)
            );
            remainingHours = Math.floor(
              (remainingTimeInMilliseconds % (1000 * 60 * 60 * 24)) /
                (1000 * 60 * 60)
            );
            remainingMinutes = Math.floor(
              (remainingTimeInMilliseconds % (1000 * 60 * 60)) / (1000 * 60)
            );
            remainingSeconds = Math.floor(
              (remainingTimeInMilliseconds % (1000 * 60)) / 1000
            );
            // Ensure leading zeros for single-digit values
            remainingDays = String(remainingDays).padStart(2, "0");
            remainingHours = String(remainingHours).padStart(2, "0");
            remainingMinutes = String(remainingMinutes).padStart(2, "0");
            remainingSeconds = String(remainingSeconds).padStart(2, "0");
            // Update HTML elements with formatted time
            document.getElementById("remaining-time-days").innerHTML =
              remainingDays;
            document.getElementById("remaining-time-hour").innerHTML =
              remainingHours;
            document.getElementById("remaining-time-min").innerHTML =
              remainingMinutes;
            document.getElementById("remaining-time-sec").innerHTML =
              remainingSeconds;
            if (remainingTimeInMilliseconds <= 0) {
              clearInterval(countDownInterval);
              // Stop the countdown
              document.getElementById("remaining-time").style.display = "none";
              document.getElementById("contract-result").style.display = "flex";
            }
          }, 1000);
        } else {
          document.getElementById("remaining-time-days").innerHTML = 0;
          document.getElementById("remaining-time-hour").innerHTML = 0;
          document.getElementById("remaining-time-min").innerHTML = 0;
          document.getElementById("remaining-time-sec").innerHTML = 0;
        }
      }
      function convertDuration() {
        const contractDuration = document.getElementById(
          "form-output-duration-0"
        ).innerHTML;
        const duration = Math.floor(contractDuration / 86400);
        console.log("Duration : " + duration);
        document.getElementById("form-duration-_date").innerHTML = duration;
      }
      async function fetchContractEvent() {
        const abi = [
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "string",
                name: "eventName",
                type: "string",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_amount",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_timestamp",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_endTime",
                type: "uint256",
              },
            ],
            name: "depositMade",
            type: "event",
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "string",
                name: "eventName",
                type: "string",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_amount",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_timestamp",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_endTime",
                type: "uint256",
              },
            ],
            name: "releaseMade",
            type: "event",
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "string",
                name: "eventName",
                type: "string",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_amount",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_timestamp",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_endTime",
                type: "uint256",
              },
            ],
            name: "addAmountMade",
            type: "event",
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "string",
                name: "eventName",
                type: "string",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_period",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_timestamp",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_endTime",
                type: "uint256",
              },
            ],
            name: "addTimeMade",
            type: "event",
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "string",
                name: "eventName",
                type: "string",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_amount",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_timestamp",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "_endTime",
                type: "uint256",
              },
            ],
            name: "refundMade",
            type: "event",
          },
        ];
        const formatDate = (timestamp) => {
          const date = new Date(timestamp);
          const hours = date.getUTCHours().toString().padStart(2, "0");
          const minutes = date.getUTCMinutes().toString().padStart(2, "0");
          const day = date.getUTCDate();
          const month = date.toLocaleString("en-US", {
            month: "short",
            timeZone: "UTC",
          });
          const year = date.getUTCFullYear();
          return `${hours}:${minutes} GMT, ${day} ${month} ${year}`;
        };
        try {
          const chainId = document.getElementById(
            "form-output-getChainID-0"
          ).innerHTML;
          const ETHERSCAN_API_KEY = "SEIYVZ5748VEMBUAJ1WZZ25USEUYBMJKKT";
          // Replace with your actual Etherscan API key
          const networkMap = {
            1: "mainnet",
            3: "ropsten",
            4: "rinkeby",
            5: "goerli",
            42: "kovan",
            11155111: "sepolia",
          };
          const network = networkMap[chainId] || "mainnet";
          const provider = new ethers.providers.EtherscanProvider(
            network,
            ETHERSCAN_API_KEY
          );
          const escrowAddress = document.getElementById(
            "form-output-getContractAddress-0"
          ).innerHTML;
          const contract = new ethers.Contract(escrowAddress, abi, provider);
          const lastBlockKey = `lastBlock_${escrowAddress}`;
          let lastBlock = parseInt(
            localStorage.getItem(lastBlockKey) || "0",
            10
          );
          const fetchEvents = async (eventName) => {
            try {
              const latestBlock = await provider.getBlockNumber();
              let startBlock = lastBlock;
              if (startBlock > latestBlock) {
                startBlock = 0;
              }
              if (eventName === "addAmountMade") {
                startBlock = Math.max(0, startBlock - 10);
              }
              console.log(
                `Fetching ${eventName} events from block ${startBlock} to ${latestBlock}`
              );
              await new Promise((resolve) => setTimeout(resolve, 1000));
              const events = await contract.queryFilter(
                eventName,
                startBlock,
                latestBlock
              );
              localStorage.setItem(lastBlockKey, latestBlock.toString());
              return events.map((event) => ({
                eventName:
                  event.args && event.args.eventName
                    ? event.args.eventName
                    : null,
                amount:
                  event.args && event.args._amount
                    ? ethers.utils.formatUnits(event.args._amount, 18)
                    : null, // Assuming 18 decimals
                period:
                  event.args && event.args._period
                    ? event.args._period.toNumber()
                    : null,
                timestamp:
                  event.args && event.args._timestamp
                    ? new Date(
                        event.args._timestamp.toNumber() * 1000
                      ).toISOString()
                    : null,
                endTime:
                  event.args && event.args._endTime
                    ? new Date(
                        event.args._endTime.toNumber() * 1000
                      ).toISOString()
                    : null,
                transactionHash: event.transactionHash, // Add this line to include the transaction hash
              }));
            } catch (error) {
              console.error(
                `Failed to fetch ${eventName}
  events`,
                error
              );
              return [];
            }
          };
          const [
            depositEvents,
            releaseEvents,
            addAmountEvents,
            addTimeEvents,
            refundEvents,
          ] = await Promise.all([
            fetchEvents("depositMade"),
            fetchEvents("releaseMade"),
            fetchEvents("addAmountMade"),
            fetchEvents("addTimeMade"),
            fetchEvents("refundMade"),
          ]);
          let eventLog = [];
          try {
            eventLog = localStorage.getItem("EventLog")
              ? JSON.parse(localStorage.getItem("EventLog"))
              : [];
          } catch (err) {
            console.log("eventlog - error", err);
          }
          console.log("eventLog", eventLog);
          console.log("depositEvents:", depositEvents);
          console.log("releaseEvents:", releaseEvents);
          console.log("addAmountEvents:", addAmountEvents);
          console.log("addTimeEvents:", addTimeEvents);
          console.log("refundEvents:", refundEvents);
          // Combine all events and remove duplicates
          const allEvents = [
            ...eventLog,
            ...depositEvents,
            ...releaseEvents,
            ...addAmountEvents,
            ...addTimeEvents,
            ...refundEvents,
          ];
          const uniqueEvents = allEvents.filter(
            (event, index, self) =>
              index ===
              self.findIndex((t) => t.transactionHash === event.transactionHash)
          );
          // Sort events by timestamp
          uniqueEvents.sort(
            (a, b) => new Date(a.timestamp) - new Date(b.timestamp)
          );
          console.log("uniqueEvents", uniqueEvents);
          localStorage.setItem("EventLog", JSON.stringify(uniqueEvents));
          let transactionLog = "";
          uniqueEvents.forEach((data) => {
            transactionLog +=
              "<tr>" +
              "<td>" +
              data.eventName +
              "</td>" +
              "<td>" +
              (data.amount == null ? "NaN" : data.amount) +
              "</td>" +
              "<td>" +
              (data.timestamp ? formatDate(data.timestamp) : "NaN") +
              "</td>" +
              "<td>" +
              (data.endTime ? formatDate(data.endTime) : "NaN") +
              "</td>" +
              "</tr>";
          });
          document.getElementById("transactionTbody").innerHTML =
            transactionLog;
          populateSwiper();
        } catch (error) {
          console.error(
            "An error occurred while fetching contract events",
            error
          );
        }
      }
    </script>
  </body>
</html>
