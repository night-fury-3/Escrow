<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./frontend.css">
    <title>Simple Web Page</title>
</head>
<body>
	<div class="main">
	  <div class="content">
		<div class="logo-heading">Escrow Contract
		</div>
		<div class="center">
		  <div class="w-halfLeft">
			<div class="front-left">
			  <div class="address">
				<div class="time-line">
				  <div class="title">Total Funds In Escrow:
				  </div>
				  <div class="time-infor">
					<div class="time">
					  <span id="form-total-amount" class="fm-control">Amount</span>
					  <span id="token-symbol" class="unit">USDT</span>
					</div>
				  </div>
				</div>
				<div class="time-line">
				  <div class="title">Released Amount:
				  </div>
				  <div class="time-infor">
					<div class="time">
					  <span id="form-released-amount" class="fm-control">Amount</span>
					  <span id="token-name" class="unit">USDT</span>
					</div>
				  </div>
				</div>
			  </div>
			  <div id="remaining-time" class="remaining-time">
				<div class="time-big">
				  <div id="time-hour-dis" class="time-hour">
					<div id="remaining-time-days">00
					</div>
					<div class="remaining-time-div">:
					</div>
					<div id="remaining-time-hour">00
					</div>
					<div class="remaining-time-div">:
					</div>
					<div id="remaining-time-min">00
					</div>
					<div class="remaining-time-div">:
					</div>
					<div id="remaining-time-sec">00
					</div>
				  </div>
				  <div id="iv96ql" class="time-unit">
					<span>Days</span>
					<span>Hrs</span>
					<span>Min</span>
					<span>Sec</span>
				  </div>
				</div>
				<div class="alert">
				  <div id="ivygf">Remaining time until expiry
				  </div>
				</div>
			  </div>
			  <div id="contract-result" class="contract-history">
				<div id="result-title">Contract Expired
				</div>
			  </div>
			</div>
		  </div>
		  <div class="w-halfRight">
			<div class="date">
			  <div class="left">
				<div class="time-duration">
				  <div class="title">StartDate:
				  </div>
				  <div class="time-number">
					<div class="time">
					  <span id="form-start-_date" class="fm-control">Date</span>
					</div>
				  </div>
				</div>
				<div class="time-duration">
				  <div class="title">EndDate:
				  </div>
				  <div class="time-number">
					<div class="time">
					  <span id="form-end-_date" class="fm-control">Date</span>
					</div>
				  </div>
				</div>
				<div class="time-duration">
				  <div class="title">Duration:
				  </div>
				  <div class="time-number">
					<div class="time">
					  <span id="form-duration-_date" class="fm-control">Date</span>
					  <span id="form-unit" class="timeunit">Days</span>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="cms">
				<div class="cms hidden">
				  <button id="start-date" type="button" data-form-name="startTime" class="btn btn-primary mt-2">StartDate</button>
				  <span id="form-output-startTime-0" data-form-name="startTime" data-field-type="uint256" class="form-control">uint256</span>
				  <button id="contract-duration" type="button" data-form-name="duration" class="btn btn-primary mt-2">Duration</button>
				  <span id="form-output-duration-0" data-form-name="duration" data-field-type="uint256" class="form-control">uint256</span>
				  <button id="end-date" type="button" data-form-name="endTime" class="btn btn-primary mt-2">EndTime</button>
				  <span id="form-output-endTime-0" data-form-name="endTime" data-field-type="uint256">uint256</span>
				  <button id="total-amount" type="button" data-form-name="amount" class="btn btn-primary mt-2">TotalfundsinEscrow</button>
				  <span id="form-output-amount-0" data-form-name="amount" data-field-type="uint256">uint256</span>
				  <button id="released-amount" type="button" data-form-name="totalReleasedAmount" class="btn btn-primary mt-2">TotalReleasedAmount</button>
				  <span id="form-output-totalReleasedAmount-0" data-form-name="totalReleasedAmount" data-field-type="uint256">uint256</span>
				  <button id="getchainId" type="button" data-form-name="getChainID" class="btn btn-primary mt-2">
					Read
				  </button>
				  <span id="form-output-getChainID-0" data-form-name="getChainID" data-field-type="uint256">uint256</span>
				</div>
			  </div>
			</div>
			<div class="address">
			  <table id="transactionTable" class="desktop-only">
				<thead>
				  <tr class="table-title">
					<th>Type of Transaction
					</th>
					<th>Amount
					</th>
					<th>Transaction Date
					</th>
					<th id="iyv7bo">Contract Expiry Date
					</th>
				  </tr>
				</thead>
				<tbody id="transactionTbody" class="table-body">
				</tbody>
			  </table>
			  <div id="ivzl83" class="flex flex-row mobile-only">
				<div id="i0nnjf" class="flex flex-col mobile-only">
				  <div>Type of Transaction
				  </div>
				  <div>Amount
				  </div>
				  <div>Transaction Date
				  </div>
				  <div>Contract Expiry Date
				  </div>
				</div>
				<div id="igtvl2" class="swiper-container mobile-only">
				  <div class="swiper-wrapper">
				  </div>
				  <div class="swiper-pagination">
				  </div>
				</div>
			  </div>
			</div>
			<div class="address">
			  <div class="time-line">
				<div class="title">Escrow Contract Address:
				</div>
				<div class="time-infor">
				  <div>
					<span id="form-escrow-_address" class="fm-control">Address</span>
				  </div>
				</div>
			  </div>
			  <div class="time-line">
				<div class="title">Depositor Wallet Address:
				</div>
				<div class="time-infor">
				  <div>
					<span id="form-depositor-_address" class="fm-control">Address</span>
				  </div>
				</div>
			  </div>
			  <div class="time-line">
				<div class="title">Recipient Wallet Address:
				</div>
				<div class="time-infor">
				  <div>
					<span id="form-recipient-_address" class="fm-control">Address</span>
				  </div>
				</div>
			  </div>
			  <div class="cms hidden">
				<button id="escrow-address" type="button" data-form-name="getContractAddress" class="btn btn-primary mt-2">EscrowContractAddress</button>
				<span id="form-output-getContractAddress-0" data-form-name="getContractAddress" data-field-type="address" class="form-control">address</span>
				<button id="client-address" type="button" data-form-name="client" class="btn btn-primary mt-2">Client</button>
				<span id="form-output-client-0" data-form-name="client" data-field-type="address" class="form-control">address</span>
				<button id="dev-address" type="button" data-form-name="dev" class="btn btn-primary mt-2">Developer</button>
				<span id="form-output-dev-0" data-form-name="dev" data-field-type="address" class="form-control hidden">address</span>
				<button id="usdt-address" type="button" data-form-name="USDT" class="btn btn-primary mt-2 hidden">tokenAddress</button>
				<span id="form-output-USDT-0" data-form-name="USDT" data-field-type="address" class="form-control hidden">address</span>
			  </div>
			</div>
			<div class="note">
			  <div>
				<strong id="ixsw2o">Note:</strong> 
				After expiration of escrow funds will go back to the Depositing Party
			  </div>
			</div>
		  </div>
		</div>
		<div class="footer">
		  <div class="bottom">
			<div class="icon">
			  <div id="ijqgwc">Copyright Â©2024 Forward Factory
			  </div>
			</div>
			<div class="icon">
			  <a href="https://forwardfactory.ai"><svg fill="none" width="16" xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 16 16">
				<path d="M16 8C16 3.6 12.4 0 8 0C3.6 0 0 3.6 0 8C0 12 2.9 15.3 6.7 15.9V10.3H4.7V8H6.7V6.2C6.7 4.2 7.9 3.1 9.7 3.1C10.6 3.1 11.5 3.3 11.5 3.3V5.3H10.5C9.5 5.3 9.2 5.9 9.2 6.5V8H11.4L11 10.3H9.1V16C13.1 15.4 16 12 16 8Z" fill="white">
				</path>
				</svg></a>
			  <a href="https://forwardfactory.ai"><svg fill="none" width="16" xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 16 16">
				<path d="M8 1.44578C10.1205 1.44578 10.4096 1.44578 11.2771 1.44578C12.0482 1.44578 12.4337 1.63855 12.7229 1.73494C13.1084 1.92771 13.3976 2.0241 13.6867 2.31325C13.9759 2.60241 14.1687 2.89157 14.2651 3.27711C14.3614 3.56627 14.4578 3.95181 14.5542 4.72289C14.5542 5.59036 14.5542 5.78313 14.5542 8C14.5542 10.2169 14.5542 10.4096 14.5542 11.2771C14.5542 12.0482 14.3614 12.4337 14.2651 12.7229C14.0723 13.1084 13.9759 13.3976 13.6867 13.6867C13.3976 13.9759 13.1084 14.1687 12.7229 14.2651C12.4337 14.3614 12.0482 14.4578 11.2771 14.5542C10.4096 14.5542 10.2169 14.5542 8 14.5542C5.78313 14.5542 5.59036 14.5542 4.72289 14.5542C3.95181 14.5542 3.56627 14.3614 3.27711 14.2651C2.89157 14.0723 2.60241 13.9759 2.31325 13.6867C2.0241 13.3976 1.83133 13.1084 1.73494 12.7229C1.63855 12.4337 1.54217 12.0482 1.44578 11.2771C1.44578 10.4096 1.44578 10.2169 1.44578 8C1.44578 5.78313 1.44578 5.59036 1.44578 4.72289C1.44578 3.95181 1.63855 3.56627 1.73494 3.27711C1.92771 2.89157 2.0241 2.60241 2.31325 2.31325C2.60241 2.0241 2.89157 1.83133 3.27711 1.73494C3.56627 1.63855 3.95181 1.54217 4.72289 1.44578C5.59036 1.44578 5.87952 1.44578 8 1.44578ZM8 0C5.78313 0 5.59036 0 4.72289 0C3.85542 0 3.27711 0.192772 2.79518 0.385543C2.31325 0.578314 1.83133 0.867471 1.3494 1.3494C0.867471 1.83133 0.674699 2.21687 0.385543 2.79518C0.192772 3.27711 0.0963856 3.85542 0 4.72289C0 5.59036 0 5.87952 0 8C0 10.2169 0 10.4096 0 11.2771C0 12.1446 0.192772 12.7229 0.385543 13.2048C0.578314 13.6867 0.867471 14.1687 1.3494 14.6506C1.83133 15.1325 2.21687 15.3253 2.79518 15.6145C3.27711 15.8072 3.85542 15.9036 4.72289 16C5.59036 16 5.87952 16 8 16C10.1205 16 10.4096 16 11.2771 16C12.1446 16 12.7229 15.8072 13.2048 15.6145C13.6867 15.4217 14.1687 15.1325 14.6506 14.6506C15.1325 14.1687 15.3253 13.7831 15.6145 13.2048C15.8072 12.7229 15.9036 12.1446 16 11.2771C16 10.4096 16 10.1205 16 8C16 5.87952 16 5.59036 16 4.72289C16 3.85542 15.8072 3.27711 15.6145 2.79518C15.4217 2.31325 15.1325 1.83133 14.6506 1.3494C14.1687 0.867471 13.7831 0.674699 13.2048 0.385543C12.7229 0.192772 12.1446 0.0963856 11.2771 0C10.4096 0 10.2169 0 8 0Z" fill="white">
				</path>
				<path d="M8 3.85542C5.68675 3.85542 3.85542 5.68675 3.85542 8C3.85542 10.3133 5.68675 12.1446 8 12.1446C10.3133 12.1446 12.1446 10.3133 12.1446 8C12.1446 5.68675 10.3133 3.85542 8 3.85542ZM8 10.6988C6.55422 10.6988 5.30121 9.54217 5.30121 8C5.30121 6.55422 6.45783 5.30121 8 5.30121C9.44578 5.30121 10.6988 6.45783 10.6988 8C10.6988 9.44578 9.44578 10.6988 8 10.6988Z" fill="white">
				</path>
				<path d="M12.241 4.72289C12.7733 4.72289 13.2048 4.29136 13.2048 3.75904C13.2048 3.22671 12.7733 2.79518 12.241 2.79518C11.7086 2.79518 11.2771 3.22671 11.2771 3.75904C11.2771 4.29136 11.7086 4.72289 12.241 4.72289Z" fill="white">
				</path>
				</svg></a>
			  <a href="https://forwardfactory.ai"><svg fill="none" width="20" xmlns="http://www.w3.org/2000/svg" height="12" viewBox="0 0 20 12">
				<path d="M2.93775 0H0.750191C0.125032 0 0 0.297095 0 0.625516C0 1.21061 0.741188 4.11486 3.45388 7.95486C5.26134 10.5782 7.80898 12 10.1266 12C11.5179 12 11.69 11.6837 11.69 11.1411V9.1584C11.69 8.52682 11.822 8.40051 12.2621 8.40051C12.5872 8.40051 13.1423 8.56421 14.4417 9.82838C15.925 11.328 16.1691 12 17.0033 12H19.1919C19.817 12 20.1301 11.6837 19.9491 11.0602C19.752 10.4397 19.0438 9.53836 18.1036 8.47023C17.5935 7.86189 16.8293 7.20606 16.5972 6.87764C16.2721 6.45625 16.3652 6.26931 16.5972 5.8944C16.5972 5.8944 19.2629 2.10088 19.541 0.812463C19.681 0.344589 19.541 0 18.8788 0H16.6912C16.1351 0 15.878 0.297095 15.739 0.625516C15.739 0.625516 14.6267 3.36505 13.0503 5.14459C12.5402 5.65996 12.3081 5.82467 12.0301 5.82467C11.891 5.82467 11.69 5.65996 11.69 5.19208V0.812463C11.69 0.25061 11.5289 0 11.0648 0H7.62594C7.27885 0 7.0698 0.260716 7.0698 0.508295C7.0698 1.04084 7.858 1.16413 7.93902 2.66274V5.91764C7.93902 6.63208 7.81198 6.76143 7.53291 6.76143C6.79173 6.76143 4.98727 4.00876 3.917 0.859958C3.70694 0.247579 3.49689 0 2.93775 0Z" fill="white" clip-rule="evenodd" fill-rule="evenodd">
				</path>
				</svg></a>
			  <a href="https://forwardfactory.ai"><svg fill="none" width="16" xmlns="http://www.w3.org/2000/svg" height="13" viewBox="0 0 16 13">
				<path d="M1.09992 5.59647C5.39487 3.76188 8.25885 2.55241 9.69185 1.96805C13.7834 0.299594 14.6335 0.00976514 15.1877 9.27819e-05C15.3095 -0.00191006 15.582 0.0277027 15.7586 0.16813C15.9076 0.286703 15.9486 0.44688 15.9683 0.5593C15.9879 0.671721 16.0123 0.927819 15.9929 1.12793C15.7712 3.41192 14.8118 8.95457 14.3237 11.5127C14.1172 12.5951 13.7105 12.958 13.3168 12.9936C12.4613 13.0707 11.8116 12.4392 10.9829 11.9067C9.68624 11.0733 8.95369 10.5545 7.69503 9.74136C6.24042 8.80157 7.18338 8.28505 8.01236 7.44091C8.22931 7.21999 11.999 3.85836 12.0719 3.55341C12.0811 3.51527 12.0895 3.37311 12.0034 3.29804C11.9172 3.22297 11.7901 3.24864 11.6983 3.26906C11.5683 3.29799 9.4968 4.64035 5.48389 7.29611C4.89591 7.69195 4.36333 7.88482 3.88616 7.87472C3.36012 7.86357 2.34822 7.58311 1.59598 7.34338C0.673328 7.04933 -0.0599784 6.89387 0.00387615 6.3945C0.0371355 6.13439 0.402482 5.86838 1.09992 5.59647Z" fill="white">
				</path>
				</svg></a>
			  <button id="transaction-history" type="button" onclick="fetchContractEvent()" class="btn btn-primary mt-2 hidden">Transaction History</button>
			</div>
		  </div>
		</div>
	  </div>
	</div>
	<script src="https://cdn.ethers.io/lib/ethers-5.7.1.esm.min.js"></script>
	<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
	<script defer>
	  function populateSwiper() {
		const tableBody = document.getElementById("transactionTbody");
		const swiperWrapper = document.querySelector(".swiper-wrapper");
		swiperWrapper.innerHTML = "";
		// Clear existing slides
		Array.from(tableBody.children).forEach((row, index) => {
		  const swiperSlide = document.createElement("div");
		  swiperSlide.className = "swiper-slide";
		  swiperSlide.innerHTML =` 
  <div class="slide-content">
  <div>${row.cells[0].innerText}
	  </div>
  <div>${row.cells[1].innerText}
	  </div>
  <div>${row.cells[2].innerText}
	  </div>
  <div>${row.cells[3].innerText}
	  </div>
	  </div>
  `;
		  swiperWrapper.appendChild(swiperSlide);
		}
											  );
		// Initialize Swiper
		new Swiper(".swiper-container", {
		  slidesPerView: 1,
		  spaceBetween: 10,
		  slidesPerGroup:1,
		  pagination: {
			el: ".swiper-pagination",
			clickable: true,
		  }
		  ,
		}
				  );
	  }
	  setTimeout (() => {
		document.getElementById("usdt-address").click();
		document.getElementById("getchainId").click();
		document.getElementById("escrow-address").click();
		document.getElementById("client-address").click();
		document.getElementById("dev-address").click();
	  }
				  , 500);
	  console.log("Toeken button is clicked-------->");
	  document.getElementById("dev-address").addEventListener("click", function() {
		setTimeout(() => {
		  getDecimals();
		  convertAddress();
		}
				   , 4000);
	  }
															 );
	  function convertAddress() {
		const escrowAddress = document.getElementById("form-output-getContractAddress-0").innerHTML;
		console.log("Escrow Address : " + escrowAddress);
		document.getElementById("form-escrow-_address").innerHTML = escrowAddress;
		console.log("Escrow Address : " + escrowAddress);
		const clientAddress = document.getElementById("form-output-client-0").innerHTML;
		document.getElementById("form-depositor-_address").innerHTML = clientAddress;
		const devAddress = document.getElementById("form-output-dev-0").innerHTML;
		document.getElementById("form-recipient-_address").innerHTML = devAddress;
	  }
	  let decimal = 0;
	  var eventLog = [];
	  async function getDecimals() {
		// Fetch the list of chains
		const chainListResponse = await fetch('https://chainid.network/chains.json');
		const chainList = await chainListResponse.json();
		console.log("chianList ; " + chainList);
		// Get the current network details using a fallback method if this.parent.ethereum is not available
		const chainId = document.getElementById("form-output-getChainID-0").innerHTML;
		// Fallback to mainnet if this.parent.ethereum is not available
		console.log("chainId : " + chainId);
		// Find the matching chain data
		const chainData = chainList.find(obj => obj.chainId.toString() === chainId.toString());
		console.log("Chain Data : " + JSON.stringify(chainData));
		// Extract the RPC URL from the matched chain data
		const INFURA_API_KEY = '810dfc7ee2d74f1ea3ad5de43ada13e1';
		// Replace with your actual Infura API key
		const rpcUrl = chainData.rpc[0];
		console.log("Net URl: " + JSON.stringify(rpcUrl));
		// Create a JsonRpcProvider using the selected RPC URL
		const provider = new ethers.providers.JsonRpcProvider(rpcUrl);
		// Replace with the contract address and ABI
		const tokenAddress = document.getElementById("form-output-USDT-0").innerHTML;
		// Replace with your contract's address
		const abi = [
		  {
			"constant": true,
			"inputs": [],
			"name": "decimals",
			"outputs": [
			  {
				"name": "",
				"type": "uint8"
			  }
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
		  }
		  ,
		  {
			"constant": true,
			"inputs": [],
			"name": "symbol",
			"outputs": [
			  {
				"name": "",
				"type": "string"
			  }
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
		  }
		];
		// Instantiate the contract with the new provider
		const coinContract = new ethers.Contract(tokenAddress, abi, provider);
		// Fetch the decimals
		try {
		  const decimals = await coinContract.decimals();
		  const symbol = await coinContract.symbol();
		  console.log(`Decimals: ${decimals.toString()}
  `);
		  console.log("Symbol : " + symbol);
		  document.getElementById("token-symbol").innerText = symbol;
		  document.getElementById("token-name").innerText = symbol;
		  decimal = decimals;
		  setTimeout(() => {
			document.getElementById("total-amount").click();
			document.getElementById("released-amount").click();
			document.getElementById("start-date").click();
			document.getElementById("contract-duration").click();
			document.getElementById("end-date").click();
			document.getElementById("transaction-history").click();
			console.log("button click-------->");
		  }
					 , 500);
		}
		catch (error) {
		  console.error("Error fetching decimals:", error);
		}
	  }
	  console.log("decimal : " + decimal);
	  document.getElementById("transaction-history").addEventListener("click", function() {
		setTimeout(() => {
		  releaseFund();
		  console.log("function is called------->");
		  totalFund();
		  convertTime();
		  convertDuration();
		}
				   , 3500);
	  }
																	 );
	  function totalFund() {
		const totalAmount = document.getElementById("form-output-amount-0").innerHTML;
		console.log("totalamount :" + totalAmount, ":", decimal);
		const correctTotal = Number(totalAmount) / (10 ** decimal);
		console.log("Total Funds : " + totalAmount);
		document.getElementById("form-total-amount").innerHTML = correctTotal;
	  }
	  function releaseFund() {
		const releasedAmount = document.getElementById("form-output-totalReleasedAmount-0").innerHTML;
		const correctRelease = Number(releasedAmount) / (10 ** decimal);
		console.log("Released Amount : ", + correctRelease);
		document.getElementById("form-released-amount").innerHTML = correctRelease;
	  }
	  function convertTime() {
		function formatDate(timestamp) {
		  const date = new Date(timestamp);
		  const hours = date.getUTCHours().toString().padStart(2, '0');
		  const minutes = date.getUTCMinutes().toString().padStart(2, '0');
		  const day = date.getUTCDate();
		  const month = date.toLocaleString('en-US', {
			month: 'short', timeZone: 'UTC' }
										   );
		  const year = date.getUTCFullYear();
		  return `${hours}
  :${minutes}
  GMT, ${day}
  ${month}
  ${year}
  `;
		}
		const startTimeElement = document.getElementById("form-output-startTime-0").innerHTML;
		const startTimeStr = startTimeElement.trim();
		const startTime = parseInt(startTimeStr, 10) * 1000;
		// Convert to milliseconds if valid, otherwise set to 0
		console.log(startTime);
		const startTimeUTC = new Date(startTime).toUTCString();
		console.log(startTimeUTC);
		const endTimeElement = document.getElementById("form-output-endTime-0").innerHTML;
		const endTimeStr = endTimeElement.trim();
		const endTime = parseInt(endTimeStr, 10) * 1000;
		const endTimeUTC = new Date(endTime).toUTCString();
		const now = Math.floor(Date.now());
		console.log(endTimeUTC);
		// Always display the start and end dates
		if (startTime <= 0 || isNaN(startTime)) {
		  document.getElementById("form-start-_date").innerHTML = "Escrow not initialized yet."
		}
		else {
		  document.getElementById("form-start-_date").innerHTML = formatDate(startTime);
		  document.getElementById("form-unit").style.display = "flex";
		}
		if (endTime <= 0 || isNaN(endTime)) {
		  document.getElementById("form-end-_date").innerHTML = "Escrow not initialized yet."
		}
		else if (now > endTime) {
		  document.getElementById("form-end-_date").innerHTML = "Contract has expired."
		}
		else{
		  document.getElementById("form-end-_date").innerHTML = formatDate(endTime);
		  document.getElementById("form-unit").style.display = "flex";
		  console.log(formatDate(endTime));
		}
		if (endTime > 0) {
		  // Set up the interval to update the countdown
		  var countDownInterval = setInterval(function() {
			var currentUTCTimeInMilliseconds = new Date().getTime();
			var remainingTimeInMilliseconds = endTime - currentUTCTimeInMilliseconds;
			remainingDays = Math.floor(remainingTimeInMilliseconds / (1000 * 60 * 60 * 24));
			remainingHours = Math.floor((remainingTimeInMilliseconds % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
			remainingMinutes = Math.floor((remainingTimeInMilliseconds % (1000 * 60 * 60)) / (1000 * 60));
			remainingSeconds = Math.floor((remainingTimeInMilliseconds % (1000 * 60)) / 1000);
			// Ensure leading zeros for single-digit values
			remainingDays = String(remainingDays).padStart(2, '0');
			remainingHours = String(remainingHours).padStart(2, '0');
			remainingMinutes = String(remainingMinutes).padStart(2, '0');
			remainingSeconds = String(remainingSeconds).padStart(2, '0');
			// Update HTML elements with formatted time
			document.getElementById("remaining-time-days").innerHTML = remainingDays;
			document.getElementById("remaining-time-hour").innerHTML = remainingHours;
			document.getElementById("remaining-time-min").innerHTML = remainingMinutes;
			document.getElementById("remaining-time-sec").innerHTML = remainingSeconds;
			if (remainingTimeInMilliseconds <= 0) {
			  clearInterval(countDownInterval);
			  // Stop the countdown
			  document.getElementById("remaining-time").style.display = "none";
			  document.getElementById("contract-result").style.display = "flex";
			}
		  }
											  , 1000);
		}
		else {
		  document.getElementById("remaining-time-days").innerHTML = 0;
		  document.getElementById("remaining-time-hour").innerHTML = 0;
		  document.getElementById("remaining-time-min").innerHTML = 0;
		  document.getElementById("remaining-time-sec").innerHTML = 0;
		}
	  }
	  function convertDuration() {
		const contractDuration = document.getElementById("form-output-duration-0").innerHTML;
		const duration = Math.floor(contractDuration / 86400);
		console.log("Duration : " + duration);
		document.getElementById("form-duration-_date").innerHTML = duration;
	  }
	  async function fetchContractEvent() {
		const abi = [
		  {
			"anonymous": false,
			"inputs": [
			  {
				"indexed": false, "internalType": "string", "name": "eventName", "type": "string" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_amount", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_timestamp", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_endTime", "type": "uint256" }
			],
			"name": "depositMade",
			"type": "event"
		  }
		  ,
		  {
			"anonymous": false,
			"inputs": [
			  {
				"indexed": false, "internalType": "string", "name": "eventName", "type": "string" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_amount", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_timestamp", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_endTime", "type": "uint256" }
			],
			"name": "releaseMade",
			"type": "event"
		  }
		  ,
		  {
			"anonymous": false,
			"inputs": [
			  {
				"indexed": false, "internalType": "string", "name": "eventName", "type": "string" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_amount", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_timestamp", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_endTime", "type": "uint256" }
			],
			"name": "addAmountMade",
			"type": "event"
		  }
		  ,
		  {
			"anonymous": false,
			"inputs": [
			  {
				"indexed": false, "internalType": "string", "name": "eventName", "type": "string" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_period", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_timestamp", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_endTime", "type": "uint256" }
			],
			"name": "addTimeMade",
			"type": "event"
		  }
		  ,
		  {
			"anonymous": false,
			"inputs": [
			  {
				"indexed": false, "internalType": "string", "name": "eventName", "type": "string" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_amount", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_timestamp", "type": "uint256" }
			  ,
			  {
				"indexed": false, "internalType": "uint256", "name": "_endTime", "type": "uint256" }
			],
			"name": "refundMade",
			"type": "event"
		  }
		];
		const formatDate = (timestamp) => {
		  const date = new Date(timestamp);
		  const hours = date.getUTCHours().toString().padStart(2, '0');
		  const minutes = date.getUTCMinutes().toString().padStart(2, '0');
		  const day = date.getUTCDate();
		  const month = date.toLocaleString('en-US', {
			month: 'short', timeZone: 'UTC' }
										   );
		  const year = date.getUTCFullYear();
		  return `${hours}:${minutes} GMT, ${day} ${month} ${year}`;
		};
		try {
		  const chainId = document.getElementById("form-output-getChainID-0").innerHTML;
		  const ETHERSCAN_API_KEY = 'SEIYVZ5748VEMBUAJ1WZZ25USEUYBMJKKT';
		  // Replace with your actual Etherscan API key
		  const networkMap = {
			'1': 'mainnet',
			'3': 'ropsten',
			'4': 'rinkeby',
			'5': 'goerli',
			'42': 'kovan',
			'11155111': 'sepolia'
		  };
		  const network = networkMap[chainId] || 'mainnet';
		  const provider = new ethers.providers.EtherscanProvider(network, ETHERSCAN_API_KEY);
		  const escrowAddress = document.getElementById("form-output-getContractAddress-0").innerHTML;
		  const contract = new ethers.Contract(escrowAddress, abi, provider);
		  const lastBlockKey = `lastBlock_${escrowAddress}`;
		  let lastBlock = parseInt(localStorage.getItem(lastBlockKey) || '0', 10);
		  const fetchEvents = async (eventName) => {
			try {
			  const latestBlock = await provider.getBlockNumber();
			  let startBlock = lastBlock;
			  if (startBlock > latestBlock) {
				startBlock = 0;
			  }
			  if (eventName === "addAmountMade") {
				startBlock = Math.max(0, startBlock - 10);
			  }
			  console.log(`Fetching ${eventName} events from block ${startBlock} to ${latestBlock}`);
			  await new Promise(resolve => setTimeout(resolve, 1000));
			  const events = await contract.queryFilter(eventName, startBlock, latestBlock);
			  localStorage.setItem(lastBlockKey, latestBlock.toString());
			  return events.map(event => ({
				eventName: event.args && event.args.eventName ? event.args.eventName : null,
				amount: event.args && event.args._amount ? ethers.utils.formatUnits(event.args._amount, 18) : null, // Assuming 18 decimals
				period: event.args && event.args._period ? event.args._period.toNumber() : null,
				timestamp: event.args && event.args._timestamp ? new Date(event.args._timestamp.toNumber() * 1000).toISOString() : null,
				endTime: event.args && event.args._endTime ? new Date(event.args._endTime.toNumber() * 1000).toISOString() : null,
				transactionHash: event.transactionHash // Add this line to include the transaction hash
			  }
										 ));
			}
			catch (error) {
			  console.error(`Failed to fetch ${eventName}
  events`, error);
			  return [];
			}
		  };
		  const [depositEvents, releaseEvents, addAmountEvents, addTimeEvents, refundEvents] = await Promise.all([
			fetchEvents("depositMade"),
			fetchEvents("releaseMade"),
			fetchEvents("addAmountMade"),
			fetchEvents("addTimeMade"),
			fetchEvents("refundMade")
		  ]);
		  let eventLog = [];
		  try {
			eventLog = localStorage.getItem("EventLog") ? JSON.parse(localStorage.getItem("EventLog")) : [];
		  }
		  catch (err) {
			console.log("eventlog - error", err);
		  }
		  console.log("eventLog", eventLog);
		  console.log("depositEvents:", depositEvents);
		  console.log("releaseEvents:", releaseEvents);
		  console.log("addAmountEvents:", addAmountEvents);
		  console.log("addTimeEvents:", addTimeEvents);
		  console.log("refundEvents:", refundEvents);
		  // Combine all events and remove duplicates
		  const allEvents = [...eventLog, ...depositEvents, ...releaseEvents, ...addAmountEvents, ...addTimeEvents, ...refundEvents];
		  const uniqueEvents = allEvents.filter((event, index, self) =>
												index === self.findIndex((t) => t.transactionHash === event.transactionHash)
											   );
		  // Sort events by timestamp
		  uniqueEvents.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
		  console.log("uniqueEvents", uniqueEvents);
		  localStorage.setItem("EventLog", JSON.stringify(uniqueEvents));
		  let transactionLog = "";
		  uniqueEvents.forEach(data => {
			transactionLog += "<tr>" +
			  "<td>" + data.eventName + "</td>" +
			  "<td>" + (data.amount == null ? "NaN" : data.amount) + "</td>" +
			  "<td>" + (data.timestamp ? formatDate(data.timestamp) : "NaN") + "</td>" +
			  "<td>" + (data.endTime ? formatDate(data.endTime) : "NaN") + "</td>" +
			  "</tr>";
		  }
							  );
		  document.getElementById("transactionTbody").innerHTML = transactionLog;
		  populateSwiper();
		}
		catch (error) {
		  console.error("An error occurred while fetching contract events", error);
		}
	  }
	</script>
  </body>
  </html>